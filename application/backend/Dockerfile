FROM oven/bun:latest

ENV STRIPE_WEBHOOK_SECRET, STRIPE_SECRET_KEY, TWILIO_MESSAGING_SERVICE, TWILIO_TOKEN, TWILIO_SID, GEMINI_API_KEY
ENV MONTHLY_PRICE_ID, ANNUAL_PRICE_ID, LIFETIME_PRICE_ID
ENV POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB
ENV EMAIL_CONTACT, EMAIL_VERIFICATION
ENV JWT_SECRET, SECRET_SAUCE
ENV NODE_ENV "prod"

WORKDIR /app

COPY package.json .

RUN bun install

COPY . .

RUN bun run build

RUN chmod +x ./server

EXPOSE 3000

VOLUME [ "/etc/passwd", "/etc/shadow", "/etc/group", "/home" ]

CMD ["./server"]
